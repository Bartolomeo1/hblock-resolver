-- Load http module

modules.load('http')

webmgmt_endpoints = http.configs._builtin.webmgmt.endpoints
webmgmt_endpoints['/health'] = {'text/plain', function () return 'OK' end}

http.config({
	port = 8453,
	tls = true,
	ephemeral = false,
	cert = env.KRESD_CERT_CRT_FILE,
	key = env.KRESD_CERT_KEY_FILE,
	endpoints = webmgmt_endpoints
}, 'webmgmt')

http.config({
	port = 443,
	tls = true,
	ephemeral = false,
	cert = env.KRESD_CERT_CRT_FILE,
	key = env.KRESD_CERT_KEY_FILE
}, 'doh')
