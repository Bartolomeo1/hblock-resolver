-- Listen on defined interfaces

local nicname = env.KRESD_NIC
local interfaces = net.interfaces()
local addresses = nil

if nicname == nil or nicname == '' then
	local nicnames = {}; for k, v in pairs(interfaces) do table.insert(nicnames, k) end
	io.stdout:write('Listening on all interfaces (' .. table.concat(nicnames, ', ') .. ')\n')
	addresses = interfaces
elseif interfaces[nicname] ~= nil then
	io.stdout:write('Listening on ' .. nicname .. ' interface\n')
	addresses = interfaces[nicname]
else
	io.stderr:write('Cannot find ' .. nicname .. ' interface\n')
	os.exit(1)
end

net.tls(env.KRESD_CERT_CRT_FILE, env.KRESD_CERT_KEY_FILE)
net.listen(addresses, 53)
net.listen(addresses, 853, {tls = true})
