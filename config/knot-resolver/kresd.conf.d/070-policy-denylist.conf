-- Add denylist zone

if not stats then modules.load('stats') end

local function deny_and_count(msg)
	local deny = policy.DENY_MSG(msg)
	local stats_key = 'answer.blocked'
	stats[stats_key] = 0
	return function (_, req)
		stats[stats_key] = stats[stats_key] + 1
		return deny(_, req)
	end
end

policy.add(policy.rpz(
	deny_and_count('Blocked domain'),
	env.KRESD_DENYLIST_RPZ_FILE,
	true
))
